#!/bin/bash

if [ -r "bin/lein" ]; then
    LIBS="$(find -H lib/ -mindepth 1 -maxdepth 1 -print0 | tr \\0 \:)"
    CLASSPATH=src/:classes/:$LIBS
else
    CLASSPATH="$HOME/.m2/repository/org/clojure/lancet/1.0-SNAPSHOT/lancet-1.0-SNAPSHOT.jar"
fi

if [ $1 = "test" ]; then
    CLASSPATH=test/:$CLASSPATH
fi

if [ $1 = "repl" ]; then
    # TODO: fix for eshell
    if which rlwrap > /dev/null && $TERM != "dumb" ; then
        rlwrap java -cp "$CLASSPATH" clojure.main
    else
        java -cp "$CLASSPATH" clojure.main
    fi
else
    exec java -cp "$CLASSPATH" leiningen.core $@
fi
