#!/bin/bash

LIBS="$(find -H lib/ -mindepth 1 -maxdepth 1 -print0 | tr \\0 \:)"

CLASSPATH="src/:classes/:$LIBS"

if [ ! -r "bin/lein" ]; then
    # If we are not running from a checkout
    CLASSPATH="$CLASSPATH:$HOME/.leiningen.jar"
fi

if [ $1 = "test" ]; then
    CLASSPATH=test/:$CLASSPATH
fi

if [ $1 = "repl" ]; then
    # If repl used leiningen.core then there'd be no way to bootstrap AOT
    java -cp "$CLASSPATH" clojure.main
else
    exec java -cp "$CLASSPATH" leiningen.core $@
fi
